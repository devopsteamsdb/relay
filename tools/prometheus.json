{
    "name": "Prometheus",
    "description": "Monitoring and alerting toolkit",
    "installation_steps": {
        "pre_commands": [
            "apt-get update",
            "apt-get install -y wget curl"
        ],
        "main_commands": [
            "wget https://github.com/prometheus/prometheus/releases/download/v2.45.0/prometheus-2.45.0.linux-amd64.tar.gz",
            "tar xvfz prometheus-2.45.0.linux-amd64.tar.gz",
            "mv prometheus-2.45.0.linux-amd64 /usr/local/prometheus",
            "useradd --no-create-home --shell /bin/false prometheus",
            "mkdir /etc/prometheus",
            "mkdir /var/lib/prometheus",
            "chown prometheus:prometheus /etc/prometheus",
            "chown prometheus:prometheus /var/lib/prometheus",
            "cp /usr/local/prometheus/prometheus /usr/local/bin/",
            "cp /usr/local/prometheus/promtool /usr/local/bin/",
            "cp -r /usr/local/prometheus/consoles /etc/prometheus",
            "cp -r /usr/local/prometheus/console_libraries /etc/prometheus",
            "echo \"global:\\n  scrape_interval: 15s\\nscrape_configs:\\n  - job_name: 'prometheus'\\n    static_configs:\\n      - targets: ['localhost:9090']\" > /etc/prometheus/prometheus.yml",
            "chown prometheus:prometheus /usr/local/bin/prometheus",
            "chown prometheus:prometheus /usr/local/bin/promtool",
            "chown -R prometheus:prometheus /etc/prometheus/consoles",
            "chown -R prometheus:prometheus /etc/prometheus/console_libraries",
            "chown prometheus:prometheus /etc/prometheus/prometheus.yml",
            "echo '[Unit]\\nDescription=Prometheus\\nWants=network-online.target\\nAfter=network-online.target\\n\\n[Service]\\nUser=prometheus\\nGroup=prometheus\\nType=simple\\nExecStart=/usr/local/bin/prometheus \\n  --config.file /etc/prometheus/prometheus.yml \\n  --storage.tsdb.path /var/lib/prometheus/ \\n  --web.console.templates=/etc/prometheus/consoles \\n  --web.console.libraries=/etc/prometheus/console_libraries\\n\\n[Install]\\nWantedBy=multi-user.target' > /etc/systemd/system/prometheus.service",
            "systemctl daemon-reload",
            "systemctl enable prometheus"
        ],
        "post_commands": [
            "systemctl start prometheus"
        ],
        "verification_commands": [
            "systemctl status prometheus | grep 'active (running)'"
        ]
    },
    "idempotency_check": "systemctl is-active prometheus"
}
